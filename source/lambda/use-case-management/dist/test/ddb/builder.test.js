"use strict";
/**********************************************************************************************************************
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.                                                *
 *                                                                                                                    *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance    *
 *  with the License. A copy of the License is located at                                                             *
 *                                                                                                                    *
 *      http://www.apache.org/licenses/LICENSE-2.0                                                                    *
 *                                                                                                                    *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES *
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions    *
 *  and limitations under the License.                                                                                *
 *********************************************************************************************************************/
Object.defineProperty(exports, "__esModule", { value: true });
const storage_operation_builder_1 = require("../../ddb/storage-operation-builder");
const storage_view_builder_1 = require("../../ddb/storage-view-builder");
const list_use_cases_1 = require("../../model/list-use-cases");
const use_case_1 = require("../../model/use-case");
const constants_1 = require("../../utils/constants");
const event_test_data_1 = require("../event-test-data");
describe('When creating StackCommandBuilders', () => {
    let createEvent;
    let updateEvent;
    let deleteEvent;
    let permanentDeleteEvent;
    beforeAll(() => {
        process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR] = 'UseCaseTable';
        createEvent = event_test_data_1.createUseCaseEvent;
        createEvent.body = JSON.stringify(event_test_data_1.createUseCaseEvent.body);
        updateEvent = event_test_data_1.updateUseCaseEvent;
        updateEvent.body = JSON.stringify(event_test_data_1.updateUseCaseEvent.body);
        deleteEvent = event_test_data_1.deleteUseCaseEvent;
        permanentDeleteEvent = event_test_data_1.permanentlyDeleteUseCaseEvent;
    });
    describe('When creating PutItemCommandInputBuilder with a UseCase', () => {
        let putItemCommandBuilder;
        beforeAll(async () => {
            const cfnParameters = new Map();
            cfnParameters.set('LLMProviderName', 'HuggingFace');
            cfnParameters.set('LLMProviderModelId', 'google/flan-t5-xxl');
            const useCase = new use_case_1.UseCase('fake-id', 'fake-test', 'Create a stack for test', cfnParameters, createEvent.body, 'test-user', 'fake-template-name', 'Chat');
            useCase.stackId = 'fake-stack-id';
            const putItemInputBuilder = new storage_operation_builder_1.PutItemCommandInputBuilder(useCase);
            try {
                putItemCommandBuilder = await putItemInputBuilder.build();
            }
            catch (error) {
                console.error(`Error occurred, error is ${error}`);
            }
        });
        it('should create a PutItemCommandInputBuilder with the correct properties', () => {
            expect(putItemCommandBuilder.TableName).toEqual(process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR]);
            expect(putItemCommandBuilder.Item.StackId.S).toEqual('fake-stack-id');
            expect(putItemCommandBuilder.Item.Name.S).toEqual('fake-test');
            expect(putItemCommandBuilder.Item.Description.S).toEqual('Create a stack for test');
            expect(putItemCommandBuilder.Item.CreatedBy.S).toEqual('test-user');
        });
    });
    describe('When creating UpdateItemCommandBuilder with a UseCase', () => {
        let updateItemCommandInput;
        beforeAll(async () => {
            const cfnParameters = new Map();
            cfnParameters.set('LLMProviderName', 'HuggingFace');
            cfnParameters.set('LLMProviderModelId', 'google/flan-t5-xxl');
            const useCase = new use_case_1.UseCase('fake-id', 'fake-test', 'Create a stack for test', cfnParameters, updateEvent.body, 'test-user', 'fake-template-name', 'Chat');
            useCase.stackId = 'fake-stack-id';
            try {
                updateItemCommandInput = await new storage_operation_builder_1.UpdateItemCommandBuilder(useCase).build();
            }
            catch (error) {
                console.error(`Error occurred, error is ${error}`);
            }
        });
        it('should have the following properties', () => {
            expect(updateItemCommandInput.TableName).toEqual(process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR]);
            expect(updateItemCommandInput.Key).toEqual({ 'UseCaseId': { 'S': 'fake-id' } });
            expect(updateItemCommandInput.UpdateExpression).toEqual('SET #Description = :description, #UpdatedDate = :date, #UpdatedBy = :user, #SSMParameterKey = :ssm_parameter_key');
            expect(updateItemCommandInput.ExpressionAttributeNames).toEqual({
                '#Description': 'Description',
                '#SSMParameterKey': 'SSMParameterKey',
                '#UpdatedDate': 'UpdatedDate',
                '#UpdatedBy': 'UpdatedBy'
            });
        });
    });
    describe('When creating DeleteItemCommandBuilder with a UseCase', () => {
        let deleteCommandInput;
        beforeAll(async () => {
            const useCase = new use_case_1.UseCase('fake-id', 'fake-test', 'Create a stack for test', new Map(), deleteEvent.body, 'test-user', 'fake-template-name', 'Chat');
            useCase.stackId = 'fake-stack-id';
            try {
                deleteCommandInput = await new storage_operation_builder_1.DeleteItemCommandBuilder(useCase).build();
            }
            catch (error) {
                console.error(`Error occurred, error is ${error}`);
            }
        });
        it('should have the following properties', () => {
            expect(deleteCommandInput.TableName).toEqual(process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR]);
            expect(deleteCommandInput.Key.UseCaseId.S).toEqual('fake-id');
        });
    });
    describe('When creating DeleteItemCommandBuilder with a ChatUseCaseInfoAdapter', () => {
        let deleteCommandInput;
        beforeAll(async () => {
            const useCase = new use_case_1.ChatUseCaseInfoAdapter(deleteEvent);
            try {
                deleteCommandInput = await new storage_operation_builder_1.DeleteItemCommandBuilder(useCase).build();
            }
            catch (error) {
                console.error(`Error occurred, error is ${error}`);
            }
        });
        it('should have the following properties', () => {
            expect(deleteCommandInput.TableName).toEqual(process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR]);
            expect(deleteCommandInput.Key.UseCaseId.S).toEqual('11111111-222222222-33333333-44444444-55555555');
        });
    });
    describe('When creating MarkItemForDeletionCommandBuilder with a UseCase', () => {
        let updateItemCommandInput;
        beforeAll(async () => {
            const cfnParameters = new Map();
            cfnParameters.set('LLMProviderName', 'HuggingFace');
            cfnParameters.set('LLMProviderModelId', 'google/flan-t5-xxl');
            const useCase = new use_case_1.UseCase('fake-id', 'fake-test', 'Create a stack for test', cfnParameters, deleteEvent.body, 'test-user', 'fake-template-name', 'Chat');
            useCase.stackId = 'fake-stack-id';
            try {
                updateItemCommandInput = await new storage_operation_builder_1.MarkItemForDeletionCommandBuilder(useCase).build();
            }
            catch (error) {
                console.error(`Error occurred, error is ${error}`);
            }
        });
        it('should have the following properties', () => {
            expect(updateItemCommandInput.TableName).toEqual(process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR]);
            expect(updateItemCommandInput.Key).toEqual({ 'UseCaseId': { 'S': 'fake-id' } });
            expect(updateItemCommandInput.UpdateExpression).toEqual('SET #TTL = :expiry_time, #DeletedBy = :user, #DeletedDate = :deletion_date');
            expect(updateItemCommandInput.ExpressionAttributeNames).toEqual({
                ['#TTL']: constants_1.DYNAMODB_TTL_ATTRIBUTE_NAME,
                ['#DeletedBy']: 'DeletedBy',
                ['#DeletedDate']: 'DeletedDate'
            });
        });
    });
    describe('When creating MarkItemForDeletionCommandBuilder with a ChatUseCaseInfoAdapter', () => {
        let updateItemCommandInput;
        beforeAll(async () => {
            const useCase = new use_case_1.ChatUseCaseInfoAdapter(permanentDeleteEvent);
            try {
                updateItemCommandInput = await new storage_operation_builder_1.MarkItemForDeletionCommandBuilder(useCase).build();
            }
            catch (error) {
                console.error(`Error occurred, error is ${error}`);
            }
        });
        it('should have the following properties', () => {
            expect(updateItemCommandInput.TableName).toEqual(process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR]);
            expect(updateItemCommandInput.Key).toEqual({
                'UseCaseId': { 'S': '11111111-222222222-33333333-44444444-55555555' }
            });
            expect(updateItemCommandInput.UpdateExpression).toEqual('SET #TTL = :expiry_time, #DeletedBy = :user, #DeletedDate = :deletion_date');
            expect(updateItemCommandInput.ExpressionAttributeNames).toEqual({
                ['#TTL']: constants_1.DYNAMODB_TTL_ATTRIBUTE_NAME,
                ['#DeletedBy']: 'DeletedBy',
                ['#DeletedDate']: 'DeletedDate'
            });
        });
    });
    describe('When creating ScanCaseTableCommandBuilder with a UseCase', () => {
        let scanCommandInput;
        beforeAll(async () => {
            process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR] = 'UseCaseTable';
            const event = {
                queryStringParameters: {
                    pageSize: '10'
                }
            };
            try {
                scanCommandInput = await new storage_view_builder_1.ScanCaseTableCommandBuilder(new list_use_cases_1.ListUseCasesAdapter(event)).build();
            }
            catch (error) {
                console.error(`Error occurred, error is ${error}`);
            }
        });
        it('should have the following properties', () => {
            expect(scanCommandInput.TableName).toEqual(process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR]);
            expect(scanCommandInput.Limit).toEqual(constants_1.DDB_SCAN_RECORDS_LIMIT);
        });
    });
    afterAll(() => {
        delete process.env[constants_1.USE_CASES_TABLE_NAME_ENV_VAR];
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdGVzdC9kZGIvYnVpbGRlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7dUhBV3VIOztBQVN2SCxtRkFLNkM7QUFDN0MseUVBQTZFO0FBQzdFLCtEQUFpRTtBQUNqRSxtREFBdUU7QUFDdkUscURBSStCO0FBQy9CLHdEQUs0QjtBQUU1QixRQUFRLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO0lBQ2hELElBQUksV0FBZ0IsQ0FBQztJQUNyQixJQUFJLFdBQWdCLENBQUM7SUFDckIsSUFBSSxXQUFnQixDQUFDO0lBQ3JCLElBQUksb0JBQXlCLENBQUM7SUFFOUIsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNYLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0NBQTRCLENBQUMsR0FBRyxjQUFjLENBQUM7UUFFM0QsV0FBVyxHQUFHLG9DQUFrQixDQUFDO1FBQ2pDLFdBQVcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxvQ0FBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUzRCxXQUFXLEdBQUcsb0NBQWtCLENBQUM7UUFDakMsV0FBVyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLG9DQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTNELFdBQVcsR0FBRyxvQ0FBa0IsQ0FBQztRQUNqQyxvQkFBb0IsR0FBRywrQ0FBNkIsQ0FBQztJQUN6RCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx5REFBeUQsRUFBRSxHQUFHLEVBQUU7UUFDckUsSUFBSSxxQkFBMEMsQ0FBQztRQUUvQyxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDakIsTUFBTSxhQUFhLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7WUFDaEQsYUFBYSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxhQUFhLENBQUMsQ0FBQztZ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UUFBUSxDQUFDLDBEQUEwRCxFQUFFLEdBQUcsRUFBRTtRQUN0RSxJQUFJLGdCQUFrQyxDQUFDO1FBRXZDLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUNqQixPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUE0QixDQUFDLEdBQUcsY0FBYyxDQUFDO1lBRTNELE1BQU0sS0FBSyxHQUFHO2dCQUNWLHFCQUFxQixFQUFFO29CQUNuQixRQUFRLEVBQUUsSUFBSTtpQkFDakI7YUFDd0IsQ0FBQztZQUU5QixJQUFJO2dCQUNBLGdCQUFnQixHQUFHLE1BQU0sSUFBSSxrREFBMkIsQ0FDcEQsSUFBSSxvQ0FBbUIsQ0FBQyxLQUF3QixDQUFDLENBQ3BELENBQUMsS0FBSyxFQUFFLENBQUM7YUFDYjtZQUFDLE9BQU8sS0FBSyxFQUFFO2dCQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEtBQUssRUFBRSxDQUFDLENBQUM7YUFDdEQ7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7WUFDNUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUE0QixDQUFDLENBQUMsQ0FBQztZQUN0RixNQUFNLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLGtDQUFzQixDQUFDLENBQUM7UUFDbkUsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxHQUFHLEVBQUU7UUFDVixPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0NBQTRCLENBQUMsQ0FBQztJQUNyRCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UgICAgKlxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyAqXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgICAgKlxuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCB7XG4gICAgRGVsZXRlSXRlbUNvbW1hbmRJbnB1dCxcbiAgICBQdXRJdGVtQ29tbWFuZElucHV0LFxuICAgIFNjYW5Db21tYW5kSW5wdXQsXG4gICAgVXBkYXRlSXRlbUNvbW1hbmRJbnB1dFxufSBmcm9tICdAYXdzLXNkay9jbGllbnQtZHluYW1vZGInO1xuaW1wb3J0IHsgQVBJR2F0ZXdheUV2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5pbXBvcnQge1xuICAgIERlbGV0ZUl0ZW1Db21tYW5kQnVpbGRlcixcbiAgICBNYXJrSXRlbUZvckRlbGV0aW9uQ29tbWFuZEJ1aWxkZXIsXG4gICAgUHV0SXRlbUNvbW1hbmRJbnB1dEJ1aWxkZXIsXG4gICAgVXBkYXRlSXRlbUNvbW1hbmRCdWlsZGVyXG59IGZyb20gJy4uLy4uL2RkYi9zdG9yYWdlLW9wZXJhdGlvbi1idWlsZGVyJztcbmltcG9ydCB7IFNjYW5DYXNlVGFibGVDb21tYW5kQnVpbGRlciB9IGZyb20gJy4uLy4uL2RkYi9zdG9yYWdlLXZpZXctYnVpbGRlcic7XG5pbXBvcnQgeyBMaXN0VXNlQ2FzZXNBZGFwdGVyIH0gZnJvbSAnLi4vLi4vbW9kZWwvbGlzdC11c2UtY2FzZXMnO1xuaW1wb3J0IHsgQ2hhdFVzZUNhc2VJbmZvQWRhcHRlciwgVXNlQ2FzZSB9IGZyb20gJy4uLy4uL21vZGVsL3VzZS1jYXNlJztcbmltcG9ydCB7XG4gICAgRERCX1NDQU5fUkVDT1JEU19MSU1JVCxcbiAgICBEWU5BTU9EQl9UVExfQVRUUklCVVRFX05BTUUsXG4gICAgVVNFX0NBU0VTX1RBQkxFX05BTUVfRU5WX1ZBUlxufSBmcm9tICcuLi8uLi91dGlscy9jb25zdGFudHMnO1xuaW1wb3J0IHtcbiAgICBjcmVhdGVVc2VDYXNlRXZlbnQsXG4gICAgZGVsZXRlVXNlQ2FzZUV2ZW50LFxuICAgIHBlcm1hbmVudGx5RGVsZXRlVXNlQ2FzZUV2ZW50LFxuICAgIHVwZGF0ZVVzZUNhc2VFdmVudFxufSBmcm9tICcuLi9ldmVudC10ZXN0LWRhdGEnO1xuXG5kZXNjcmliZSgnV2hlbiBjcmVhdGluZyBTdGFja0NvbW1hbmRCdWlsZGVycycsICgpID0+IHtcbiAgICBsZXQgY3JlYXRlRXZlbnQ6IGFueTtcbiAgICBsZXQgdXBkYXRlRXZlbnQ6IGFueTtcbiAgICBsZXQgZGVsZXRlRXZlbnQ6IGFueTtcbiAgICBsZXQgcGVybWFuZW50RGVsZXRlRXZlbnQ6IGFueTtcblxuICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICAgIHByb2Nlc3MuZW52W1VTRV9DQVNFU19UQUJMRV9OQU1FX0VOVl9WQVJdID0gJ1VzZUNhc2VUYWJsZSc7XG5cbiAgICAgICAgY3JlYXRlRXZlbnQgPSBjcmVhdGVVc2VDYXNlRXZlbnQ7XG4gICAgICAgIGNyZWF0ZUV2ZW50LmJvZHkgPSBKU09OLnN0cmluZ2lmeShjcmVhdGVVc2VDYXNlRXZlbnQuYm9keSk7XG5cbiAgICAgICAgdXBkYXRlRXZlbnQgPSB1cGRhdGVVc2VDYXNlRXZlbnQ7XG4gICAgICAgIHVwZGF0ZUV2ZW50LmJvZHkgPSBKU09OLnN0cmluZ2lmeSh1cGRhdGVVc2VDYXNlRXZlbnQuYm9keSk7XG5cbiAgICAgICAgZGVsZXRlRXZlbnQgPSBkZWxldGVVc2VDYXNlRXZlbnQ7XG4gICAgICAgIHBlcm1hbmVudERlbGV0ZUV2ZW50ID0gcGVybWFuZW50bHlEZWxldGVVc2VDYXNlRXZlbnQ7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnV2hlbiBjcmVhdGluZyBQdXRJdGVtQ29tbWFuZElucHV0QnVpbGRlciB3aXRoIGEgVXNlQ2FzZScsICgpID0+IHtcbiAgICAgICAgbGV0IHB1dEl0ZW1Db21tYW5kQnVpbGRlcjogUHV0SXRlbUNvbW1hbmRJbnB1dDtcblxuICAgICAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2ZuUGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG4gICAgICAgICAgICBjZm5QYXJhbWV0ZXJzLnNldCgnTExNUHJvdmlkZXJOYW1lJywgJ0h1Z2dpbmdGYWNlJyk7XG4gICAgICAgICAgICBjZm5QYXJhbWV0ZXJzLnNldCgnTExNUHJvdmlkZXJNb2RlbElkJywgJ2dvb2dsZS9mbGFuLXQ1LXh4bCcpO1xuICAgICAgICAgICAgY29uc3QgdXNlQ2FzZSA9IG5ldyBVc2VDYXNlKFxuICAgICAgICAgICAgICAgICdmYWtlLWlkJyxcbiAgICAgICAgICAgICAgICAnZmFrZS10ZXN0JyxcbiAgICAgICAgICAgICAgICAnQ3JlYXRlIGEgc3RhY2sgZm9yIHRlc3QnLFxuICAgICAgICAgICAgICAgIGNmblBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgY3JlYXRlRXZlbnQuYm9keSxcbiAgICAgICAgICAgICAgICAndGVzdC11c2VyJyxcbiAgICAgICAgICAgICAgICAnZmFrZS10ZW1wbGF0ZS1uYW1lJyxcbiAgICAgICAgICAgICAgICAnQ2hhdCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB1c2VDYXNlLnN0YWNrSWQgPSAnZmFrZS1zdGFjay1pZCc7XG4gICAgICAgICAgICBjb25zdCBwdXRJdGVtSW5wdXRCdWlsZGVyID0gbmV3IFB1dEl0ZW1Db21tYW5kSW5wdXRCdWlsZGVyKHVzZUNhc2UpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBwdXRJdGVtQ29tbWFuZEJ1aWxkZXIgPSBhd2FpdCBwdXRJdGVtSW5wdXRCdWlsZGVyLmJ1aWxkKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIG9jY3VycmVkLCBlcnJvciBpcyAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIFB1dEl0ZW1Db21tYW5kSW5wdXRCdWlsZGVyIHdpdGggdGhlIGNvcnJlY3QgcHJvcGVydGllcycsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChwdXRJdGVtQ29tbWFuZEJ1aWxkZXIuVGFibGVOYW1lKS50b0VxdWFsKHByb2Nlc3MuZW52W1VTRV9DQVNFU19UQUJMRV9OQU1FX0VOVl9WQVJdKTtcbiAgICAgICAgICAgIGV4cGVjdChwdXRJdGVtQ29tbWFuZEJ1aWxkZXIuSXRlbSEuU3RhY2tJZC5TKS50b0VxdWFsKCdmYWtlLXN0YWNrLWlkJyk7XG4gICAgICAgICAgICBleHBlY3QocHV0SXRlbUNvbW1hbmRCdWlsZGVyLkl0ZW0hLk5hbWUuUykudG9FcXVhbCgnZmFrZS10ZXN0Jyk7XG4gICAgICAgICAgICBleHBlY3QocHV0SXRlbUNvbW1hbmRCdWlsZGVyLkl0ZW0hLkRlc2NyaXB0aW9uLlMpLnRvRXF1YWwoJ0NyZWF0ZSBhIHN0YWNrIGZvciB0ZXN0Jyk7XG4gICAgICAgICAgICBleHBlY3QocHV0SXRlbUNvbW1hbmRCdWlsZGVyLkl0ZW0hLkNyZWF0ZWRCeS5TKS50b0VxdWFsKCd0ZXN0LXVzZXInKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnV2hlbiBjcmVhdGluZyBVcGRhdGVJdGVtQ29tbWFuZEJ1aWxkZXIgd2l0aCBhIFVzZUNhc2UnLCAoKSA9PiB7XG4gICAgICAgIGxldCB1cGRhdGVJdGVtQ29tbWFuZElucHV0OiBVcGRhdGVJdGVtQ29tbWFuZElucHV0O1xuICAgICAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2ZuUGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG4gICAgICAgICAgICBjZm5QYXJhbWV0ZXJzLnNldCgnTExNUHJvdmlkZXJOYW1lJywgJ0h1Z2dpbmdGYWNlJyk7XG4gICAgICAgICAgICBjZm5QYXJhbWV0ZXJzLnNldCgnTExNUHJvdmlkZXJNb2RlbElkJywgJ2dvb2dsZS9mbGFuLXQ1LXh4bCcpO1xuICAgICAgICAgICAgY29uc3QgdXNlQ2FzZSA9IG5ldyBVc2VDYXNlKFxuICAgICAgICAgICAgICAgICdmYWtlLWlkJyxcbiAgICAgICAgICAgICAgICAnZmFrZS10ZXN0JyxcbiAgICAgICAgICAgICAgICAnQ3JlYXRlIGEgc3RhY2sgZm9yIHRlc3QnLFxuICAgICAgICAgICAgICAgIGNmblBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgdXBkYXRlRXZlbnQuYm9keSxcbiAgICAgICAgICAgICAgICAndGVzdC11c2VyJyxcbiAgICAgICAgICAgICAgICAnZmFrZS10ZW1wbGF0ZS1uYW1lJyxcbiAgICAgICAgICAgICAgICAnQ2hhdCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB1c2VDYXNlLnN0YWNrSWQgPSAnZmFrZS1zdGFjay1pZCc7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQgPSBhd2FpdCBuZXcgVXBkYXRlSXRlbUNvbW1hbmRCdWlsZGVyKHVzZUNhc2UpLmJ1aWxkKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIG9jY3VycmVkLCBlcnJvciBpcyAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KHVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQuVGFibGVOYW1lKS50b0VxdWFsKHByb2Nlc3MuZW52W1VTRV9DQVNFU19UQUJMRV9OQU1FX0VOVl9WQVJdKTtcbiAgICAgICAgICAgIGV4cGVjdCh1cGRhdGVJdGVtQ29tbWFuZElucHV0LktleSkudG9FcXVhbCh7ICdVc2VDYXNlSWQnOiB7ICdTJzogJ2Zha2UtaWQnIH0gfSk7XG4gICAgICAgICAgICBleHBlY3QodXBkYXRlSXRlbUNvbW1hbmRJbnB1dC5VcGRhdGVFeHByZXNzaW9uKS50b0VxdWFsKFxuICAgICAgICAgICAgICAgICdTRVQgI0Rlc2NyaXB0aW9uID0gOmRlc2NyaXB0aW9uLCAjVXBkYXRlZERhdGUgPSA6ZGF0ZSwgI1VwZGF0ZWRCeSA9IDp1c2VyLCAjU1NNUGFyYW1ldGVyS2V5ID0gOnNzbV9wYXJhbWV0ZXJfa2V5J1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGV4cGVjdCh1cGRhdGVJdGVtQ29tbWFuZElucHV0LkV4cHJlc3Npb25BdHRyaWJ1dGVOYW1lcykudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgJyNEZXNjcmlwdGlvbic6ICdEZXNjcmlwdGlvbicsXG4gICAgICAgICAgICAgICAgJyNTU01QYXJhbWV0ZXJLZXknOiAnU1NNUGFyYW1ldGVyS2V5JyxcbiAgICAgICAgICAgICAgICAnI1VwZGF0ZWREYXRlJzogJ1VwZGF0ZWREYXRlJyxcbiAgICAgICAgICAgICAgICAnI1VwZGF0ZWRCeSc6ICdVcGRhdGVkQnknXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnV2hlbiBjcmVhdGluZyBEZWxldGVJdGVtQ29tbWFuZEJ1aWxkZXIgd2l0aCBhIFVzZUNhc2UnLCAoKSA9PiB7XG4gICAgICAgIGxldCBkZWxldGVDb21tYW5kSW5wdXQ6IERlbGV0ZUl0ZW1Db21tYW5kSW5wdXQ7XG5cbiAgICAgICAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVzZUNhc2UgPSBuZXcgVXNlQ2FzZShcbiAgICAgICAgICAgICAgICAnZmFrZS1pZCcsXG4gICAgICAgICAgICAgICAgJ2Zha2UtdGVzdCcsXG4gICAgICAgICAgICAgICAgJ0NyZWF0ZSBhIHN0YWNrIGZvciB0ZXN0JyxcbiAgICAgICAgICAgICAgICBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpLFxuICAgICAgICAgICAgICAgIGRlbGV0ZUV2ZW50LmJvZHksXG4gICAgICAgICAgICAgICAgJ3Rlc3QtdXNlcicsXG4gICAgICAgICAgICAgICAgJ2Zha2UtdGVtcGxhdGUtbmFtZScsXG4gICAgICAgICAgICAgICAgJ0NoYXQnXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdXNlQ2FzZS5zdGFja0lkID0gJ2Zha2Utc3RhY2staWQnO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBkZWxldGVDb21tYW5kSW5wdXQgPSBhd2FpdCBuZXcgRGVsZXRlSXRlbUNvbW1hbmRCdWlsZGVyKHVzZUNhc2UpLmJ1aWxkKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIG9jY3VycmVkLCBlcnJvciBpcyAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGRlbGV0ZUNvbW1hbmRJbnB1dC5UYWJsZU5hbWUpLnRvRXF1YWwocHJvY2Vzcy5lbnZbVVNFX0NBU0VTX1RBQkxFX05BTUVfRU5WX1ZBUl0pO1xuICAgICAgICAgICAgZXhwZWN0KGRlbGV0ZUNvbW1hbmRJbnB1dC5LZXkhLlVzZUNhc2VJZC5TKS50b0VxdWFsKCdmYWtlLWlkJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1doZW4gY3JlYXRpbmcgRGVsZXRlSXRlbUNvbW1hbmRCdWlsZGVyIHdpdGggYSBDaGF0VXNlQ2FzZUluZm9BZGFwdGVyJywgKCkgPT4ge1xuICAgICAgICBsZXQgZGVsZXRlQ29tbWFuZElucHV0OiBEZWxldGVJdGVtQ29tbWFuZElucHV0O1xuXG4gICAgICAgIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB1c2VDYXNlID0gbmV3IENoYXRVc2VDYXNlSW5mb0FkYXB0ZXIoZGVsZXRlRXZlbnQpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBkZWxldGVDb21tYW5kSW5wdXQgPSBhd2FpdCBuZXcgRGVsZXRlSXRlbUNvbW1hbmRCdWlsZGVyKHVzZUNhc2UpLmJ1aWxkKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIG9jY3VycmVkLCBlcnJvciBpcyAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGRlbGV0ZUNvbW1hbmRJbnB1dC5UYWJsZU5hbWUpLnRvRXF1YWwocHJvY2Vzcy5lbnZbVVNFX0NBU0VTX1RBQkxFX05BTUVfRU5WX1ZBUl0pO1xuICAgICAgICAgICAgZXhwZWN0KGRlbGV0ZUNvbW1hbmRJbnB1dC5LZXkhLlVzZUNhc2VJZC5TKS50b0VxdWFsKCcxMTExMTExMS0yMjIyMjIyMjItMzMzMzMzMzMtNDQ0NDQ0NDQtNTU1NTU1NTUnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnV2hlbiBjcmVhdGluZyBNYXJrSXRlbUZvckRlbGV0aW9uQ29tbWFuZEJ1aWxkZXIgd2l0aCBhIFVzZUNhc2UnLCAoKSA9PiB7XG4gICAgICAgIGxldCB1cGRhdGVJdGVtQ29tbWFuZElucHV0OiBVcGRhdGVJdGVtQ29tbWFuZElucHV0O1xuICAgICAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2ZuUGFyYW1ldGVycyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG4gICAgICAgICAgICBjZm5QYXJhbWV0ZXJzLnNldCgnTExNUHJvdmlkZXJOYW1lJywgJ0h1Z2dpbmdGYWNlJyk7XG4gICAgICAgICAgICBjZm5QYXJhbWV0ZXJzLnNldCgnTExNUHJvdmlkZXJNb2RlbElkJywgJ2dvb2dsZS9mbGFuLXQ1LXh4bCcpO1xuICAgICAgICAgICAgY29uc3QgdXNlQ2FzZSA9IG5ldyBVc2VDYXNlKFxuICAgICAgICAgICAgICAgICdmYWtlLWlkJyxcbiAgICAgICAgICAgICAgICAnZmFrZS10ZXN0JyxcbiAgICAgICAgICAgICAgICAnQ3JlYXRlIGEgc3RhY2sgZm9yIHRlc3QnLFxuICAgICAgICAgICAgICAgIGNmblBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgZGVsZXRlRXZlbnQuYm9keSxcbiAgICAgICAgICAgICAgICAndGVzdC11c2VyJyxcbiAgICAgICAgICAgICAgICAnZmFrZS10ZW1wbGF0ZS1uYW1lJyxcbiAgICAgICAgICAgICAgICAnQ2hhdCdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB1c2VDYXNlLnN0YWNrSWQgPSAnZmFrZS1zdGFjay1pZCc7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQgPSBhd2FpdCBuZXcgTWFya0l0ZW1Gb3JEZWxldGlvbkNvbW1hbmRCdWlsZGVyKHVzZUNhc2UpLmJ1aWxkKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIG9jY3VycmVkLCBlcnJvciBpcyAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KHVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQuVGFibGVOYW1lKS50b0VxdWFsKHByb2Nlc3MuZW52W1VTRV9DQVNFU19UQUJMRV9OQU1FX0VOVl9WQVJdKTtcbiAgICAgICAgICAgIGV4cGVjdCh1cGRhdGVJdGVtQ29tbWFuZElucHV0LktleSkudG9FcXVhbCh7ICdVc2VDYXNlSWQnOiB7ICdTJzogJ2Zha2UtaWQnIH0gfSk7XG4gICAgICAgICAgICBleHBlY3QodXBkYXRlSXRlbUNvbW1hbmRJbnB1dC5VcGRhdGVFeHByZXNzaW9uKS50b0VxdWFsKFxuICAgICAgICAgICAgICAgICdTRVQgI1RUTCA9IDpleHBpcnlfdGltZSwgI0RlbGV0ZWRCeSA9IDp1c2VyLCAjRGVsZXRlZERhdGUgPSA6ZGVsZXRpb25fZGF0ZSdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBleHBlY3QodXBkYXRlSXRlbUNvbW1hbmRJbnB1dC5FeHByZXNzaW9uQXR0cmlidXRlTmFtZXMpLnRvRXF1YWwoe1xuICAgICAgICAgICAgICAgIFsnI1RUTCddOiBEWU5BTU9EQl9UVExfQVRUUklCVVRFX05BTUUsXG4gICAgICAgICAgICAgICAgWycjRGVsZXRlZEJ5J106ICdEZWxldGVkQnknLFxuICAgICAgICAgICAgICAgIFsnI0RlbGV0ZWREYXRlJ106ICdEZWxldGVkRGF0ZSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdXaGVuIGNyZWF0aW5nIE1hcmtJdGVtRm9yRGVsZXRpb25Db21tYW5kQnVpbGRlciB3aXRoIGEgQ2hhdFVzZUNhc2VJbmZvQWRhcHRlcicsICgpID0+IHtcbiAgICAgICAgbGV0IHVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQ6IFVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQ7XG5cbiAgICAgICAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVzZUNhc2UgPSBuZXcgQ2hhdFVzZUNhc2VJbmZvQWRhcHRlcihwZXJtYW5lbnREZWxldGVFdmVudCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQgPSBhd2FpdCBuZXcgTWFya0l0ZW1Gb3JEZWxldGlvbkNvbW1hbmRCdWlsZGVyKHVzZUNhc2UpLmJ1aWxkKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIG9jY3VycmVkLCBlcnJvciBpcyAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KHVwZGF0ZUl0ZW1Db21tYW5kSW5wdXQuVGFibGVOYW1lKS50b0VxdWFsKHByb2Nlc3MuZW52W1VTRV9DQVNFU19UQUJMRV9OQU1FX0VOVl9WQVJdKTtcbiAgICAgICAgICAgIGV4cGVjdCh1cGRhdGVJdGVtQ29tbWFuZElucHV0LktleSkudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgJ1VzZUNhc2VJZCc6IHsgJ1MnOiAnMTExMTExMTEtMjIyMjIyMjIyLTMzMzMzMzMzLTQ0NDQ0NDQ0LTU1NTU1NTU1JyB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGV4cGVjdCh1cGRhdGVJdGVtQ29tbWFuZElucHV0LlVwZGF0ZUV4cHJlc3Npb24pLnRvRXF1YWwoXG4gICAgICAgICAgICAgICAgJ1NFVCAjVFRMID0gOmV4cGlyeV90aW1lLCAjRGVsZXRlZEJ5ID0gOnVzZXIsICNEZWxldGVkRGF0ZSA9IDpkZWxldGlvbl9kYXRlJ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGV4cGVjdCh1cGRhdGVJdGVtQ29tbWFuZElucHV0LkV4cHJlc3Npb25BdHRyaWJ1dGVOYW1lcykudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgWycjVFRMJ106IERZTkFNT0RCX1RUTF9BVFRSSUJVVEVfTkFNRSxcbiAgICAgICAgICAgICAgICBbJyNEZWxldGVkQnknXTogJ0RlbGV0ZWRCeScsXG4gICAgICAgICAgICAgICAgWycjRGVsZXRlZERhdGUnXTogJ0RlbGV0ZWREYXRlJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1doZW4gY3JlYXRpbmcgU2NhbkNhc2VUYWJsZUNvbW1hbmRCdWlsZGVyIHdpdGggYSBVc2VDYXNlJywgKCkgPT4ge1xuICAgICAgICBsZXQgc2NhbkNvbW1hbmRJbnB1dDogU2NhbkNvbW1hbmRJbnB1dDtcblxuICAgICAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgcHJvY2Vzcy5lbnZbVVNFX0NBU0VTX1RBQkxFX05BTUVfRU5WX1ZBUl0gPSAnVXNlQ2FzZVRhYmxlJztcblxuICAgICAgICAgICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICAgICAgICAgICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiAnMTAnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBhcyBQYXJ0aWFsPEFQSUdhdGV3YXlFdmVudD47XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgc2NhbkNvbW1hbmRJbnB1dCA9IGF3YWl0IG5ldyBTY2FuQ2FzZVRhYmxlQ29tbWFuZEJ1aWxkZXIoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBMaXN0VXNlQ2FzZXNBZGFwdGVyKGV2ZW50IGFzIEFQSUdhdGV3YXlFdmVudClcbiAgICAgICAgICAgICAgICApLmJ1aWxkKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIG9jY3VycmVkLCBlcnJvciBpcyAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KHNjYW5Db21tYW5kSW5wdXQuVGFibGVOYW1lKS50b0VxdWFsKHByb2Nlc3MuZW52W1VTRV9DQVNFU19UQUJMRV9OQU1FX0VOVl9WQVJdKTtcbiAgICAgICAgICAgIGV4cGVjdChzY2FuQ29tbWFuZElucHV0LkxpbWl0KS50b0VxdWFsKEREQl9TQ0FOX1JFQ09SRFNfTElNSVQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGFmdGVyQWxsKCgpID0+IHtcbiAgICAgICAgZGVsZXRlIHByb2Nlc3MuZW52W1VTRV9DQVNFU19UQUJMRV9OQU1FX0VOVl9WQVJdO1xuICAgIH0pO1xufSk7XG4iXX0=